---
import { client } from '../data/client';
interface Props { title?: string; description?: string; }
const { title = client.titreSEO, description = client.descriptionSEO } = Astro.props;
---
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <meta name="description" content={description} />
  <meta name="keywords" content={client.motsCles} />
  <meta name="robots" content="index, follow" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:locale" content="fr_FR" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context":"https://schema.org","@type":"HomeAndConstructionBusiness",
    "name":client.nom,"description":client.descriptionSEO,
    "telephone":client.telephoneLink.replace("tel:",""),"email":client.email,
    "address":{"@type":"PostalAddress","streetAddress":client.adresse.split(",")[0],"addressLocality":client.ville,"postalCode":"66000","addressCountry":"FR"},
    "areaServed":{"@type":"State","name":client.region},"priceRange":"$$"
  })} />
</head>
<body>
  <slot />

  <style is:global>
    /* ═══ RESET & BASE ═══ */
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html{scroll-behavior:smooth;scroll-padding-top:80px;}
    body{font-family:'Outfit',sans-serif;background:#FAFAF9;color:#1C1917;-webkit-font-smoothing:antialiased;overflow-x:hidden;}
    ::selection{background:rgba(217,119,6,0.15);}
    img{max-width:100%;display:block;}
    a{color:inherit;text-decoration:none;}

    /* ═══ CSS VARIABLES ═══ */
    :root{
      --primary:#D97706;--primary-dark:#B45309;--primary-light:#FBBF24;
      --dark:#1C1917;--text:#44403C;--text-muted:#78716C;--text-light:#A8A29E;
      --bg:#FAFAF9;--bg-alt:#F5F5F4;--card:#FFFFFF;--border:#E7E5E4;
    }

    .container{max-width:1140px;margin:0 auto;padding:0 clamp(1rem,4vw,2.5rem);}
    .section{padding:clamp(4rem,8vw,7rem) 0;}
    .section-alt{background:var(--bg-alt);}
    .text-brand{color:var(--primary);}
    .gradient-text{background:linear-gradient(135deg,var(--primary),#92400E);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
    .gradient-text-light{background:linear-gradient(135deg,#FDE68A,var(--primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}

    /* ═══ SCROLL REVEAL ANIMATIONS ═══ */
    .reveal{opacity:0;transform:translateY(30px);transition:opacity 0.8s cubic-bezier(0.16,1,0.3,1),transform 0.8s cubic-bezier(0.16,1,0.3,1),filter 0.8s cubic-bezier(0.16,1,0.3,1);will-change:transform,opacity;}
    .reveal.visible{opacity:1;transform:translateY(0);}
    .reveal-d1{transition-delay:0.1s;}.reveal-d2{transition-delay:0.2s;}.reveal-d3{transition-delay:0.3s;}.reveal-d4{transition-delay:0.4s;}

    /* Slide variants */
    .slide-left{opacity:0;transform:translateX(-40px);transition:opacity 0.8s cubic-bezier(0.16,1,0.3,1),transform 0.8s cubic-bezier(0.16,1,0.3,1);will-change:transform,opacity;}
    .slide-left.visible{opacity:1;transform:translateX(0);}
    .slide-right{opacity:0;transform:translateX(40px);transition:opacity 0.8s cubic-bezier(0.16,1,0.3,1),transform 0.8s cubic-bezier(0.16,1,0.3,1);will-change:transform,opacity;}
    .slide-right.visible{opacity:1;transform:translateX(0);}

    /* Scale In */
    .scale-in{opacity:0;transform:scale(0.85);transition:opacity 0.8s cubic-bezier(0.16,1,0.3,1),transform 0.8s cubic-bezier(0.16,1,0.3,1);will-change:transform,opacity;}
    .scale-in.visible{opacity:1;transform:scale(1);}

    /* Blur to Sharp */
    .blur-sharp{opacity:0;filter:blur(8px);transform:scale(1.02);transition:opacity 0.9s ease,filter 0.9s ease,transform 0.9s ease;will-change:filter,opacity,transform;}
    .blur-sharp.visible{opacity:1;filter:blur(0);transform:scale(1);}

    /* Clip Reveal (mask from left) */
    .clip-reveal{clip-path:inset(0 100% 0 0);transition:clip-path 1s cubic-bezier(0.16,1,0.3,1);will-change:clip-path;}
    .clip-reveal.visible{clip-path:inset(0 0 0 0);}

    /* Hover Lift */
    .hover-lift{transition:transform 0.4s cubic-bezier(0.16,1,0.3,1),box-shadow 0.4s;}
    .hover-lift:hover{transform:translateY(-6px);box-shadow:0 12px 40px rgba(0,0,0,0.08);}

    /* Image Zoom on hover */
    .img-zoom{overflow:hidden;}
    .img-zoom img{transition:transform 0.6s cubic-bezier(0.16,1,0.3,1);}
    .img-zoom:hover img{transform:scale(1.06);}

    /* ═══ KEYFRAME ANIMATIONS ═══ */

    /* Ken Burns — slow zoom + pan */
    @keyframes kenBurns{
      0%{transform:scale(1) translate(0,0);}
      50%{transform:scale(1.08) translate(-1%,-1%);}
      100%{transform:scale(1) translate(0,0);}
    }
    .ken-burns img{animation:kenBurns 20s ease-in-out infinite;will-change:transform;}

    /* Float / Bobbing */
    @keyframes floatUp{
      0%,100%{transform:translateY(0);}
      50%{transform:translateY(-12px);}
    }
    .float{animation:floatUp 4s ease-in-out infinite;}

    /* Breathing Scale */
    @keyframes breathe{
      0%,100%{transform:scale(1);}
      50%{transform:scale(1.03);}
    }
    .breathe{animation:breathe 5s ease-in-out infinite;}

    /* Gradient Shift */
    @keyframes gradShift{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }
    .gradient-shift{background-size:200% 200%;animation:gradShift 6s ease infinite;}

    /* Scroll indicator dot */
    @keyframes scrollDot{
      0%,100%{transform:translateX(-50%) translateY(0);opacity:1;}
      50%{transform:translateX(-50%) translateY(14px);opacity:0.3;}
    }

    /* Particle float */
    @keyframes particleFloat{
      0%,100%{transform:translateY(0) translateX(0);opacity:0.15;}
      25%{transform:translateY(-20px) translateX(10px);opacity:0.3;}
      50%{transform:translateY(-5px) translateX(-8px);opacity:0.2;}
      75%{transform:translateY(-15px) translateX(5px);opacity:0.1;}
    }

    /* Counter blink */
    @keyframes counterPop{
      0%{transform:scale(1);}
      50%{transform:scale(1.08);}
      100%{transform:scale(1);}
    }

    /* ═══ REDUCE MOTION ═══ */
    @media(prefers-reduced-motion:reduce){
      .reveal,.slide-left,.slide-right,.scale-in,.blur-sharp,.clip-reveal{
        opacity:1!important;transform:none!important;filter:none!important;clip-path:none!important;transition:none!important;
      }
      .ken-burns img,.float,.breathe{animation:none!important;}
    }
  </style>

  <!-- ═══ MASTER SCRIPT — All animation engines ═══ -->
  <script>
    // ── Scroll Reveal (IntersectionObserver) ──
    const revealObs = new IntersectionObserver(
      (entries) => entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); } }),
      { threshold: 0.08, rootMargin: '0px 0px -40px 0px' }
    );
    document.querySelectorAll('.reveal,.slide-left,.slide-right,.scale-in,.blur-sharp,.clip-reveal').forEach(el => revealObs.observe(el));

    // ── Animated Counters ──
    const counterObs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (!e.isIntersecting) return;
        const el = e.target as HTMLElement;
        const target = parseInt(el.dataset.count || '0');
        const suffix = el.dataset.suffix || '';
        const duration = 1800;
        const start = performance.now();
        const animate = (now: number) => {
          const progress = Math.min((now - start) / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
          el.textContent = Math.floor(target * eased) + suffix;
          if (progress < 1) requestAnimationFrame(animate);
          else { el.textContent = target + suffix; el.style.animation = 'counterPop 0.3s ease'; }
        };
        requestAnimationFrame(animate);
        counterObs.unobserve(el);
      });
    }, { threshold: 0.5 });
    document.querySelectorAll('[data-count]').forEach(el => counterObs.observe(el));

    // ── 3D Tilt on hover ──
    document.querySelectorAll<HTMLElement>('[data-tilt]').forEach(card => {
      const maxTilt = parseInt(card.dataset.tilt || '6');
      card.addEventListener('mousemove', (e) => {
        const rect = card.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;
        card.style.transform = `perspective(800px) rotateY(${x * maxTilt}deg) rotateX(${-y * maxTilt}deg) translateY(-4px)`;
      });
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'perspective(800px) rotateY(0) rotateX(0) translateY(0)';
        card.style.transition = 'transform 0.5s cubic-bezier(0.16,1,0.3,1)';
        setTimeout(() => card.style.transition = '', 500);
      });
    });

    // ── Simple Parallax ──
    const parallaxEls = document.querySelectorAll<HTMLElement>('[data-parallax]');
    if (parallaxEls.length) {
      window.addEventListener('scroll', () => {
        const scrollY = window.scrollY;
        parallaxEls.forEach(el => {
          const speed = parseFloat(el.dataset.parallax || '0.1');
          const rect = el.getBoundingClientRect();
          if (rect.top < window.innerHeight && rect.bottom > 0) {
            el.style.transform = `translateY(${scrollY * speed}px)`;
          }
        });
      }, { passive: true });
    }

    // ── Navbar scroll ──
    const nav = document.getElementById('navbar');
    window.addEventListener('scroll', () => nav?.classList.toggle('scrolled', window.scrollY > 40), { passive: true });

    // ── Burger menu ──
    const burger = document.getElementById('burger');
    const mobileMenu = document.getElementById('mobile-menu');
    burger?.addEventListener('click', () => {
      burger.classList.toggle('open');
      mobileMenu?.classList.toggle('open');
    });
    mobileMenu?.querySelectorAll('a').forEach(a =>
      a.addEventListener('click', () => { burger?.classList.remove('open'); mobileMenu?.classList.remove('open'); })
    );
  </script>
</body>
</html>
